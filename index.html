
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>治療費シミュレーター</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #f0f9ff;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Data Definitions (v2) ---

        const PERIODS = [
            { id: 'current', label: '現行制度' },
            { id: 'r8', label: '令和8年8月〜 (上限額引上げ)' },
            { id: 'r9', label: '令和9年8月〜 (区分細分化)' }
        ];

        const DRUG_DATA = [
            {
                id: 'tezspire',
                name: 'テゼスパイア',
                options: [
                    { label: '1本/月 (12回/年)', cost: 170987, annualCount: 12 },
                    { label: '2本/回 (6回/年)', cost: 341974, annualCount: 6 },
                    { label: '3本/回 (4回/年)', cost: 512961, annualCount: 4 },
                ],
                hasManagementFee: true
            },
            {
                id: 'fasenra',
                name: 'ファセンラ',
                options: [
                    { label: '標準 (6回/年)', cost: 335309, annualCount: 6 },
                ],
                hasManagementFee: true
            },
            {
                id: 'dupixent',
                name: 'デュピクセント',
                options: [
                    { label: '2本/月 (12回/年)', cost: 107318, annualCount: 12 },
                    { label: '4本/回 (6回/年)', cost: 214636, annualCount: 6 },
                    { label: '6本/回 (4回/年)', cost: 321954, annualCount: 4 },
                ],
                hasManagementFee: true
            },
            {
                id: 'nucala',
                name: 'ヌーカラ',
                options: [
                    { label: '1本/月 (12回/年)', cost: 159891, annualCount: 12 },
                    { label: '2本/回 (6回/年)', cost: 319782, annualCount: 6 },
                    { label: '3本/回 (4回/年)', cost: 479673, annualCount: 4 },
                ],
                hasManagementFee: true
            },
            {
                id: 'exidencer',
                name: 'エキシデンサー',
                options: [
                    { label: '1回投与 (2回/年)', cost: 1000000, annualCount: 2 },
                ],
                hasManagementFee: false
            }
        ];

        // Master Data for 3 Patterns
        const MASTER_DATA = {
            current: {
                under70: [
                    { id: 'c-u70-a', label: 'ア (年収1160万円〜)', standardBase: 252600, rate: 0.01, deductionBase: 842000, majorityCap: 140100 },
                    { id: 'c-u70-i', label: 'イ (年収770〜1160万円)', standardBase: 167400, rate: 0.01, deductionBase: 558000, majorityCap: 93000 },
                    { id: 'c-u70-u', label: 'ウ (年収370〜770万円)', standardBase: 80100, rate: 0.01, deductionBase: 267000, majorityCap: 44400 },
                    { id: 'c-u70-e', label: 'エ (年収〜370万円)', standardBase: 57600, rate: 0, deductionBase: 0, majorityCap: 44400 },
                    { id: 'c-u70-o', label: 'オ (住民税非課税)', standardBase: 35400, rate: 0, deductionBase: 0, majorityCap: 24600 },
                ],
                over70: [
                    { id: 'c-o70-3', label: '現役並みⅢ (課税所得690万円〜)', standardBase: 252600, rate: 0.01, deductionBase: 842000, majorityCap: 140100 },
                    { id: 'c-o70-2', label: '現役並みⅡ (課税所得380万円〜)', standardBase: 167400, rate: 0.01, deductionBase: 558000, majorityCap: 93000 },
                    { id: 'c-o70-1', label: '現役並みⅠ (課税所得145万円〜)', standardBase: 80100, rate: 0.01, deductionBase: 267000, majorityCap: 44400 },
                    { id: 'c-o70-gen', label: '一般 (年収156〜約370万円)', standardBase: 57600, rate: 0, deductionBase: 0, majorityCap: 18000 }, // Note: Assuming standard outpatient cap for consistency with prompt desire, but keeping logic
                    { id: 'c-o70-low2', label: '低所得Ⅱ (住民税非課税)', standardBase: 24600, rate: 0, deductionBase: 0, majorityCap: 24600 },
                    { id: 'c-o70-low1', label: '低所得Ⅰ (年金80万円以下)', standardBase: 15000, rate: 0, deductionBase: 0, majorityCap: 15000 },
                ]
            },
            r8: {
                under70: [
                    { id: 'r8-u70-a', label: 'ア (年収1160万円〜)', standardBase: 260000, rate: 0.01, deductionBase: 842000, majorityCap: 145000 },
                    { id: 'r8-u70-i', label: 'イ (年収770〜1160万円)', standardBase: 180000, rate: 0.01, deductionBase: 558000, majorityCap: 100000 },
                    { id: 'r8-u70-u', label: 'ウ (年収370〜770万円)', standardBase: 90000, rate: 0.01, deductionBase: 267000, majorityCap: 50000 },
                    { id: 'r8-u70-e', label: 'エ (年収〜370万円)', standardBase: 65000, rate: 0, deductionBase: 0, majorityCap: 50000 },
                    { id: 'r8-u70-o', label: 'オ (住民税非課税)', standardBase: 38000, rate: 0, deductionBase: 0, majorityCap: 26000 },
                ],
                over70: [
                    // Assuming slight increase similar to under70 for R8
                    { id: 'r8-o70-3', label: '現役並みⅢ (課税所得690万円〜)', standardBase: 260000, rate: 0.01, deductionBase: 842000, majorityCap: 145000 },
                    { id: 'r8-o70-2', label: '現役並みⅡ (課税所得380万円〜)', standardBase: 180000, rate: 0.01, deductionBase: 558000, majorityCap: 100000 },
                    { id: 'r8-o70-1', label: '現役並みⅠ (課税所得145万円〜)', standardBase: 90000, rate: 0.01, deductionBase: 267000, majorityCap: 50000 },
                    { id: 'r8-o70-gen', label: '一般 (年収156〜約370万円)', standardBase: 65000, rate: 0, deductionBase: 0, majorityCap: 19000 },
                    { id: 'r8-o70-low2', label: '低所得Ⅱ (住民税非課税)', standardBase: 26000, rate: 0, deductionBase: 0, majorityCap: 26000 },
                    { id: 'r8-o70-low1', label: '低所得Ⅰ (年金80万円以下)', standardBase: 16000, rate: 0, deductionBase: 0, majorityCap: 16000 },
                ]
            },
            r9: {
                under70: [
                    { id: 'r9-u70-a', label: 'ア (年収1160万円〜)', standardBase: 303000, rate: 0.01, deductionBase: 842000, majorityCap: 140100 },
                    { id: 'r9-u70-i', label: 'イ (年収770〜1160万円)', standardBase: 270000, rate: 0.01, deductionBase: 558000, majorityCap: 140100 },
                    { id: 'r9-u70-u3', label: 'ウ-3 (年収600〜770万円)', standardBase: 179000, rate: 0.01, deductionBase: 400000, majorityCap: 93000 }, // deductionBase assumed estimate
                    { id: 'r9-u70-u2', label: 'ウ-2 (年収450〜600万円)', standardBase: 120000, rate: 0.01, deductionBase: 300000, majorityCap: 60000 },
                    { id: 'r9-u70-u1', label: 'ウ-1 (年収370〜450万円)', standardBase: 85800, rate: 0.01, deductionBase: 267000, majorityCap: 44400 },
                    { id: 'r9-u70-e', label: 'エ (年収〜370万円)', standardBase: 57600, rate: 0, deductionBase: 0, majorityCap: 44400 },
                    { id: 'r9-u70-o', label: 'オ (住民税非課税)', standardBase: 35400, rate: 0, deductionBase: 0, majorityCap: 24600 },
                ],
                over70: [
                    { id: 'r9-o70-3', label: '現役並み (年収1160万〜)', standardBase: 303000, rate: 0.01, deductionBase: 842000, majorityCap: 140100 },
                    { id: 'r9-o70-2', label: '現役並み (年収770〜1160万)', standardBase: 270000, rate: 0.01, deductionBase: 558000, majorityCap: 140100 },
                    { id: 'r9-o70-g3', label: '一般-3 (年収600〜770万)', standardBase: 179000, rate: 0.01, deductionBase: 400000, majorityCap: 93000 },
                    { id: 'r9-o70-g2', label: '一般-2 (年収450〜600万)', standardBase: 110000, rate: 0.01, deductionBase: 300000, majorityCap: 60000 },
                    { id: 'r9-o70-g1', label: '一般-1 (年収156〜450万)', standardBase: 57600, rate: 0, deductionBase: 0, majorityCap: 44400 },
                    { id: 'r9-o70-low2', label: '低所得Ⅱ (住民税非課税)', standardBase: 24600, rate: 0, deductionBase: 0, majorityCap: 24600 },
                    { id: 'r9-o70-low1', label: '低所得Ⅰ (年金80万円以下)', standardBase: 15000, rate: 0, deductionBase: 0, majorityCap: 15000 },
                ]
            }
        };

        const MANAGEMENT_FEE = 6500;

        // --- Components ---

        const { useState, useEffect, useMemo } = React;
        const { Calculator, ArrowRight, Wallet, TrendingDown, TrendingUp, Info, Scale, AlertCircle } = lucide;

        function App() {
            // State
            const [period, setPeriod] = useState('current'); // 'current', 'r8', 'r9'
            const [ageGroup, setAgeGroup] = useState('under70'); // 'under70' | 'over70'
            const [incomeBracketId, setIncomeBracketId] = useState('');
            const [isMajority, setIsMajority] = useState(false); // false=初年度, true=2年目以降

            // Current Drug State
            const [currentDrugId, setCurrentDrugId] = useState('tezspire');
            const [currentDrugOptionIndex, setCurrentDrugOptionIndex] = useState(0);
            const [currentManualCount, setCurrentManualCount] = useState(12);

            // Target Drug State (After)
            const [targetDrugName, setTargetDrugName] = useState('エキシデンサー');
            const [targetDrugCost, setTargetDrugCost] = useState(1000000); // 10割
            const [targetDrugCount, setTargetDrugCount] = useState(2);
            const [targetHasManagementFee, setTargetHasManagementFee] = useState(true);

            // Helper to get brackets
            const getBrackets = (p, a) => {
                return MASTER_DATA[p][a];
            };

            const activeBrackets = useMemo(() => getBrackets(period, ageGroup), [period, ageGroup]);

            // Set default bracket when period or age changes
            useEffect(() => {
                // Try to keep selection if ID exists in new list (unlikely across periods for some), or default to middle/standard
                // Actually safer to reset to first or similar index.
                // Let's reset to the "middle" or "standard" equivalent if possible, or just the first.
                // For better UX, let's map indices. But IDs are different.
                // Defaulting to the 3rd item (usually 'category U') or similar.
                if (activeBrackets.length > 2) {
                    setIncomeBracketId(activeBrackets[2].id);
                } else {
                    setIncomeBracketId(activeBrackets[0].id);
                }
            }, [period, ageGroup]);

            // Sync manual count and option
            useEffect(() => {
                const drug = DRUG_DATA.find(d => d.id === currentDrugId);
                if (drug && drug.options[currentDrugOptionIndex]) {
                    setCurrentManualCount(drug.options[currentDrugOptionIndex].annualCount);
                }
            }, [currentDrugId, currentDrugOptionIndex]);

            // Helper to calculation
            const calculateCost = (totalMedicalCost100, count, p, age, bracketId, majorityMode) => {
                const brackets = getBrackets(p, age);
                const bracket = brackets.find(b => b.id === bracketId);

                if (!bracket) return {
                    monthlySelfPay: 0,
                    annualSelfPay: 0,
                    isCapped: false,
                    windowPay: 0,
                    totalMedicalCost100: totalMedicalCost100
                };

                // 1. Calculate Standard Ceiling
                let standardCeiling = bracket.standardBase;
                if (bracket.rate > 0) {
                    standardCeiling += (totalMedicalCost100 - bracket.deductionBase) * bracket.rate;
                }

                // 2. Initial Co-pay (Window Pay)
                let coPayRate = 0.3;
                if (age === 'over70') {
                    // Simplified logic logic mapping
                    // Check if "Gen-3/Present" -> 30%
                    // We can infer from bracket label or data. 
                    // Usually highest income >70 is 30%.
                    // For R9 check label "現役並み"
                    if (bracket.label.includes('現役並み') || bracket.label.includes('課税所得')) {
                        coPayRate = 0.3;
                    } else {
                        coPayRate = 0.2; // Standard for general over 70
                        // Note: "Low income" is effectively 10% in some contexts or lower cap, but 20% window pay is standard until cap is hit. 
                        // Actually low income over 75 is 10%, but let's stick to 20% > cap logic for simplicity unless specified.
                    }
                }

                const windowPay = totalMedicalCost100 * coPayRate;

                // 3. Determine Monthly Self Pay
                let monthlySelfPay = windowPay;
                let isCapped = false;

                // Compare with Ceiling
                // Note: For low income, the ceiling is often fixed.

                if (windowPay > standardCeiling) {
                    isCapped = true;
                    // Apply Cap
                    if (majorityMode) {
                        monthlySelfPay = bracket.majorityCap;
                    } else {
                        monthlySelfPay = standardCeiling;
                    }
                }

                monthlySelfPay = Math.floor(monthlySelfPay);

                return {
                    monthlySelfPay,
                    annualSelfPay: monthlySelfPay * count,
                    isCapped,
                    windowPay,
                    totalMedicalCost100
                };
            };

            // Calculate Current (Before)
            const currentDrug = DRUG_DATA.find(d => d.id === currentDrugId);
            const currentOption = currentDrug.options[currentDrugOptionIndex];
            const currentOneTimeCost = currentOption.cost + (currentDrug.hasManagementFee ? MANAGEMENT_FEE : 0);

            const currentResult = calculateCost(
                currentOneTimeCost,
                currentManualCount,
                period,
                ageGroup,
                incomeBracketId,
                isMajority
            );

            // Calculate Target (After)
            const targetOneTimeCost = parseInt(targetDrugCost) + (targetHasManagementFee ? MANAGEMENT_FEE : 0);
            const targetResult = calculateCost(
                targetOneTimeCost,
                targetDrugCount,
                period,
                ageGroup,
                incomeBracketId,
                isMajority
            );

            const annualizedDiff = currentResult.annualSelfPay - targetResult.annualSelfPay;

            // Icons
            useEffect(() => {
                lucide.createIcons();
            });

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                        <header className="bg-gradient-to-r from-indigo-600 to-blue-600 p-6 text-white flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <i data-lucide="calculator" className="w-8 h-8"></i>
                                <h1 className="text-2xl font-bold">治療費シミュレーター</h1>
                            </div>
                            {period !== 'current' && (
                                <div className="bg-white/20 px-3 py-1 rounded-full text-sm font-semibold backdrop-blur-sm">
                                    {PERIODS.find(p => p.id === period).label} 試算中
                                </div>
                            )}
                        </header>

                        <div className="grid md:grid-cols-12 gap-0">
                            {/* LEFT COLUMN: Inputs */}
                            <div className="md:col-span-4 lg:col-span-5 bg-slate-50 p-6 border-r border-slate-200 overflow-y-auto max-h-screen">
                                <h2 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2">
                                    <i data-lucide="settings" className="w-5 h-5"></i>
                                    シミュレーション条件
                                </h2>

                                <div className="space-y-8">

                                    {/* System Period Selection (NEW) */}
                                    <section className="bg-white p-4 rounded-lg border border-indigo-100 shadow-sm">
                                        <h3 className="text-sm font-bold text-indigo-600 uppercase tracking-wider mb-3 flex items-center gap-2">
                                            <i data-lucide="scale" className="w-4 h-4"></i>
                                            制度適用時期
                                        </h3>
                                        <div className="flex flex-col gap-3">
                                            {PERIODS.map(p => (
                                                <label key={p.id} className={`flex items-center p-2 rounded cursor-pointer transition-colors ${period === p.id ? 'bg-indigo-50 border border-indigo-200' : 'hover:bg-slate-50 border border-transparent'}`}>
                                                    <input type="radio" className="form-radio text-indigo-600 h-4 w-4"
                                                        checked={period === p.id}
                                                        onChange={() => setPeriod(p.id)} />
                                                    <span className={`ml-2 text-sm ${period === p.id ? 'font-bold text-indigo-700' : 'text-slate-600'}`}>{p.label}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </section>

                                    {/* Patient Info */}
                                    <section>
                                        <h3 className="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">患者情報</h3>

                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-slate-700 mb-1">年齢区分</label>
                                            <div className="flex gap-4">
                                                <label className="inline-flex items-center">
                                                    <input type="radio" className="form-radio text-blue-600"
                                                        checked={ageGroup === 'under70'}
                                                        onChange={() => setAgeGroup('under70')} />
                                                    <span className="ml-2 text-sm text-slate-700">69歳以下</span>
                                                </label>
                                                <label className="inline-flex items-center">
                                                    <input type="radio" className="form-radio text-blue-600"
                                                        checked={ageGroup === 'over70'}
                                                        onChange={() => setAgeGroup('over70')} />
                                                    <span className="ml-2 text-sm text-slate-700">70歳以上</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-slate-700 mb-1">所得区分</label>
                                            <select className="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 text-sm p-2 border bg-white"
                                                value={incomeBracketId}
                                                onChange={(e) => setIncomeBracketId(e.target.value)}>
                                                {activeBrackets.map(b => (
                                                    <option key={b.id} value={b.id}>{b.label}</option>
                                                ))}
                                            </select>
                                            <p className="text-xs text-slate-400 mt-1">※選択した時期・年齢に応じた区分が表示されます</p>
                                        </div>

                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-slate-700 mb-1">適用期間</label>
                                            <div className="flex flex-col gap-2">
                                                <label className="inline-flex items-center">
                                                    <input type="radio" className="form-radio text-blue-600"
                                                        checked={!isMajority}
                                                        onChange={() => setIsMajority(false)} />
                                                    <span className="ml-2 text-sm text-slate-700">初年度 (標準)</span>
                                                </label>
                                                <label className="inline-flex items-center">
                                                    <input type="radio" className="form-radio text-blue-600"
                                                        checked={isMajority}
                                                        onChange={() => setIsMajority(true)} />
                                                    <span className="ml-2 text-sm text-slate-700">2年目以降 (多数回該当)</span>
                                                </label>
                                            </div>
                                        </div>
                                    </section>

                                    {/* Current Drug */}
                                    <section>
                                        <h3 className="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">現在の薬剤 (Before)</h3>
                                        <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                                            <div className="mb-3">
                                                <label className="block text-xs font-medium text-slate-500 mb-1">薬剤名</label>
                                                <select className="w-full text-sm p-2 border rounded"
                                                    value={currentDrugId}
                                                    onChange={(e) => setCurrentDrugId(e.target.value)}>
                                                    {DRUG_DATA.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}
                                                </select>
                                            </div>
                                            <div className="mb-3">
                                                <label className="block text-xs font-medium text-slate-500 mb-1">処方量/頻度</label>
                                                <select className="w-full text-sm p-2 border rounded"
                                                    value={currentDrugOptionIndex}
                                                    onChange={(e) => setCurrentDrugOptionIndex(parseInt(e.target.value))}>
                                                    {currentDrug.options.map((opt, idx) => (
                                                        <option key={idx} value={idx}>{opt.label}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div className="mb-3">
                                                <label className="block text-xs font-medium text-slate-500 mb-1">年間回数</label>
                                                <input type="number" className="w-full p-2 border rounded text-right"
                                                    value={currentManualCount}
                                                    onChange={(e) => setCurrentManualCount(parseInt(e.target.value) || 0)} />
                                            </div>
                                        </div>
                                    </section>

                                    {/* Target Drug */}
                                    <section>
                                        <div className="flex items-center gap-2 mb-3">
                                            <h3 className="text-sm font-semibold text-slate-500 uppercase tracking-wider">切替後の薬剤 (After)</h3>
                                            <span className="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full font-bold">New</span>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm">
                                            <div className="mb-3">
                                                <label className="block text-xs font-medium text-slate-500 mb-1">薬剤名</label>
                                                <input type="text" className="w-full p-2 border border-green-300 rounded"
                                                    value={targetDrugName}
                                                    onChange={(e) => setTargetDrugName(e.target.value)} />
                                            </div>
                                            <div className="mb-3">
                                                <label className="block text-xs font-medium text-slate-500 mb-1">薬剤費(10割)</label>
                                                <input type="number" className="w-full p-2 border border-green-300 rounded text-right"
                                                    value={targetDrugCost}
                                                    onChange={(e) => setTargetDrugCost(e.target.value)} />
                                            </div>
                                            <div className="mb-3">
                                                <label className="block text-xs font-medium text-slate-500 mb-1">年間回数</label>
                                                <input type="number" className="w-full p-2 border border-green-300 rounded text-right"
                                                    value={targetDrugCount}
                                                    onChange={(e) => setTargetDrugCount(e.target.value)} />
                                            </div>
                                            <div className="flex items-center">
                                                <input type="checkbox" id="mgmtFee" className="w-4 h-4 text-green-600 rounded focus:ring-green-500"
                                                    checked={targetHasManagementFee}
                                                    onChange={(e) => setTargetHasManagementFee(e.target.checked)} />
                                                <label htmlFor="mgmtFee" className="ml-2 text-sm text-slate-700">
                                                    在宅自己注射指導管理料を含める (+6,500円)
                                                </label>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>

                            {/* RIGHT COLUMN: Results */}
                            <div className="md:col-span-8 lg:col-span-7 p-6 md:p-10 bg-white">
                                <h2 className="text-xl font-bold text-slate-700 mb-6 flex items-center gap-2">
                                    <i data-lucide="wallet" className="w-6 h-6 text-blue-600"></i>
                                    シミュレーション結果
                                </h2>

                                {/* Reform Notice */}
                                {period !== 'current' && (
                                    <div className="mb-6 bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-r">
                                        <div className="flex">
                                            <div className="flex-shrink-0">
                                                <i data-lucide="alert-circle" className="h-5 w-5 text-indigo-500"></i>
                                            </div>
                                            <div className="ml-3">
                                                <p className="text-sm text-indigo-700">
                                                    <span className="font-bold">{PERIODS.find(p => p.id === period).label}</span> に基づく試算結果を表示しています。
                                                    <br />
                                                    {period === 'r9' && "※所得区分の細分化により、一部の所得層で上限額が変動しています。"}
                                                    {period === 'r8' && "※定額負担金の引き上げ案を反映しています。"}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Hero Result */}
                                <div className={`p-6 rounded-2xl mb-8 flex flex-col md:flex-row items-center justify-between shadow-lg border ${annualizedDiff > 0 ? 'bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200' : 'bg-gradient-to-br from-red-50 to-red-100 border-red-200'}`}>
                                    <div className="text-center md:text-left mb-4 md:mb-0">
                                        <p className="text-slate-600 font-medium mb-1">年間自己負担額の差額</p>
                                        <div className="flex items-baseline gap-1 justify-center md:justify-start">
                                            <span className="text-4xl md:text-5xl font-extrabold tracking-tight text-slate-800">
                                                {Math.abs(annualizedDiff).toLocaleString()}
                                            </span>
                                            <span className="text-lg text-slate-600 font-medium">円</span>
                                        </div>
                                    </div>
                                    <div className={`px-6 py-2 rounded-full font-bold text-lg flex items-center gap-2 shadow-md ${annualizedDiff > 0 ? 'bg-blue-600 text-white' : 'bg-red-500 text-white'}`}>
                                        {annualizedDiff > 0 ? (
                                            <>
                                                <i data-lucide="trending-down" className="w-5 h-5"></i>
                                                安くなります
                                            </>
                                        ) : (
                                            <>
                                                <i data-lucide="trending-up" className="w-5 h-5"></i>
                                                高くなります
                                            </>
                                        )}
                                    </div>
                                </div>

                                {/* Comparison Table */}
                                <div className="overflow-hidden border border-slate-200 rounded-xl mb-6 shadow-sm">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-50 text-slate-500 font-medium">
                                            <tr>
                                                <th className="px-6 py-4"></th>
                                                <th className="px-6 py-4 text-center">
                                                    <div className="inline-block px-3 py-1 bg-slate-200 rounded-full text-slate-700 text-xs font-bold">現在 (Before)</div>
                                                    <div className="mt-2 text-base font-bold text-slate-800">{currentDrug.name}</div>
                                                </th>
                                                <th className="px-6 py-4 text-center">
                                                    <div className="inline-block px-3 py-1 bg-green-100 rounded-full text-green-700 text-xs font-bold">切替後 (After)</div>
                                                    <div className="mt-2 text-base font-bold text-green-700">{targetDrugName}</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            <tr className="hover:bg-slate-50/50">
                                                <td className="px-6 py-4 font-medium text-slate-600">年間自己負担額</td>
                                                <td className="px-6 py-4 text-center text-xl font-bold text-slate-800">{currentResult.annualSelfPay.toLocaleString()}円</td>
                                                <td className="px-6 py-4 text-center text-xl font-bold text-green-600">{targetResult.annualSelfPay.toLocaleString()}円</td>
                                            </tr>
                                            <tr className="hover:bg-slate-50/50">
                                                <td className="px-6 py-4 text-slate-500">
                                                    1回あたり自己負担
                                                    <span className="block text-xs text-slate-400 font-normal mt-0.5">※高額療養費適用後</span>
                                                </td>
                                                <td className="px-6 py-4 text-center font-medium text-slate-700">{currentResult.monthlySelfPay.toLocaleString()}円</td>
                                                <td className="px-6 py-4 text-center font-medium text-slate-700">{targetResult.monthlySelfPay.toLocaleString()}円</td>
                                            </tr>
                                            <tr className="hover:bg-slate-50/50">
                                                <td className="px-6 py-4 text-slate-500">
                                                    制度適用
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    {currentResult.isCapped ? (
                                                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                            上限適用
                                                        </span>
                                                    ) : (
                                                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                            対象外 (窓口負担のみ)
                                                        </span>
                                                    )}
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    {targetResult.isCapped ? (
                                                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                            上限適用
                                                        </span>
                                                    ) : (
                                                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                            対象外 (窓口負担のみ)
                                                        </span>
                                                    )}
                                                </td>
                                            </tr>
                                            <tr className="hover:bg-slate-50/50">
                                                <td className="px-6 py-4 text-slate-500">
                                                    年間投与回数
                                                </td>
                                                <td className="px-6 py-4 text-center text-slate-600 text-sm">{currentManualCount}回</td>
                                                <td className="px-6 py-4 text-center text-slate-600 text-sm">{targetDrugCount}回</td>
                                            </tr>
                                        </tbody>
                                        <tfoot className="bg-slate-50 border-t border-slate-200">
                                            <tr>
                                                <td className="px-6 py-3 text-xs text-slate-400">
                                                    適用区分
                                                </td>
                                                <td colSpan="2" className="px-6 py-3 text-center text-xs text-slate-500">
                                                    {activeBrackets.find(b => b.id === incomeBracketId)?.label || '-'}
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>

                                <div className="bg-amber-50 rounded-lg p-4 border border-amber-200 text-sm text-amber-800 flex gap-3">
                                    <i data-lucide="info" className="w-5 h-5 flex-shrink-0 text-amber-600"></i>
                                    <div>
                                        <p className="font-bold mb-1">ご注意</p>
                                        <p className="leading-relaxed">
                                            この試算は概算です。実際の窓口負担額は、他の医療機関での受診状況、入院・外来の区別、世帯合算、自治体の独自助成などにより異なる場合があります。
                                            正確な金額はご加入の健康保険組合または医療機関の窓口でご確認ください。<br />
                                            ※厚労省の制度改正案に基づく試算値であり、今後の国会審議等により変更される可能性があります。
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
